<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MÃ¡quina de SÃ­labas - FonÃ©tica PT-PT Final</title>
    <style>
        :root { --machine-color: #333; --neon-blue: #00fbff; --accent: #ff007a; --bg: #1a1a1a; }
        body { margin: 0; padding: 0; font-family: 'Comic Sans MS', sans-serif; background: var(--bg); color: white; overflow: hidden; touch-action: none; text-align: center; }
        
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 5000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #start-btn {
            padding: 30px 60px; font-size: 2.5rem; background: var(--accent);
            color: white; border: none; border-radius: 60px; cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 0, 122, 0.4); font-weight: bold;
        }

        .game-world { display: flex; flex-direction: column; align-items: center; justify-content: space-around; height: 100vh; padding: 10px; }
        
        #random-btn {
            padding: 15px 30px; font-size: 1.2rem; background: #4ecca3;
            color: #1a1a1a; border: none; border-radius: 15px; font-weight: bold;
            margin-bottom: 10px; box-shadow: 0 5px #388e3c;
        }

        .machine-container { 
            position: relative; width: 90%; max-width: 400px; height: 220px; 
            background: var(--machine-color); border-radius: 30px; 
            border: 10px solid #444; display: flex; align-items: center; 
            justify-content: center; box-shadow: inset 0 0 20px #000;
        }

        .consonant-fixed { 
            font-size: 7rem; font-weight: 900; color: var(--neon-blue); 
            margin-right: 15px; text-shadow: 0 0 20px var(--neon-blue);
        }

        .vowel-drop-zone { 
            width: 110px; height: 140px; border: 5px dashed rgba(255,255,255,0.2); 
            border-radius: 20px; display: flex; align-items: center; 
            justify-content: center; font-size: 7rem; font-weight: 900; color: var(--accent); 
        }

        .vowel-carousel { display: flex; gap: 10px; padding: 20px; overflow-x: auto; width: 100%; justify-content: center; }
        .vowel-card { 
            min-width: 65px; height: 65px; background: var(--accent); 
            border-radius: 15px; display: flex; align-items: center; 
            justify-content: center; font-size: 2.5rem; font-weight: bold; 
            box-shadow: 0 5px #9d004b;
        }

        #result-display { position: fixed; top: 25%; left: 50%; transform: translate(-50%, -50%) scale(0); transition: 0.5s; z-index: 100; pointer-events: none; }
        #result-display.show { transform: translate(-50%, -50%) scale(1.8); }
        .result-image { font-size: 6rem; display: block; }
        .result-text { font-size: 2.5rem; font-weight: bold; color: #f9d423; }
    </style>
</head>
<body>

<div id="start-overlay">
    <button id="start-btn">JOGAR! ðŸš€</button>
</div>

<div class="game-world">
    <div id="result-display">
        <span class="result-image" id="res-img"></span>
        <span class="result-text" id="res-txt"></span>
    </div>

    <button id="random-btn">TROCAR LETRA ðŸŽ²</button>

    <div class="machine-container">
        <div class="consonant-fixed" id="main-consonant">V</div>
        <div class="vowel-drop-zone" id="target">?</div>
    </div>

    <div class="vowel-carousel">
        <div class="vowel-card" data-vowel="A">A</div>
        <div class="vowel-card" data-vowel="E">E</div>
        <div class="vowel-card" data-vowel="I">I</div>
        <div class="vowel-card" data-vowel="O">O</div>
        <div class="vowel-card" data-vowel="U">U</div>
    </div>
</div>

<script>
    const consonants = ['B', 'D', 'F', 'G', 'L', 'M', 'N', 'P', 'R', 'S', 'T', 'V'];
    
    // Mapeamento fonÃ©tico rigoroso para PT-PT
    const dictionary = {
        'B': { A:'BÃ', E:'BÃ‰', I:'BI', O:'BÃ“', U:'BU', img:'ðŸ””' },
        'P': { A:'PÃ', E:'PÃ‰', I:'PI', O:'PÃ“', U:'PU', img:'ðŸ¦¶' },
        'M': { A:'MÃ', E:'MÃ‰', I:'MI', O:'MÃ“', U:'MU', img:'ðŸ®' },
        'L': { A:'LÃ', E:'LÃ‰', I:'LI', O:'LÃ“', U:'LU', img:'ðŸŒ™' },
        'T': { A:'TÃ', E:'TÃ‰', I:'TI', O:'TÃ“', U:'TU', img:'ðŸš‚' },
        'V': { A:'VÃ', E:'VÃ‰', I:'VI', O:'VÃ“', U:'VU', img:'ðŸŒªï¸' },
        'D': { A:'DÃ', E:'DÃ‰', I:'DI', O:'DÃ“', U:'DU', img:'ðŸŽ²' },
        'F': { A:'FÃ', E:'FÃ‰', I:'FI', O:'FÃ“', U:'FU', img:'ðŸ”¥' },
        'S': { A:'SÃ', E:'SÃ‰', I:'SI', O:'SÃ“', U:'SU', img:'ðŸ' },
        'N': { A:'NÃ', E:'NÃ‰', I:'NI', O:'NÃ“', U:'NU', img:'ðŸ”¢' },
        'R': { A:'RÃ', E:'RÃ‰', I:'RI', O:'RÃ“', U:'RU', img:'ðŸš—' }
    };

    let activeConsonant = 'V';
    let synth = window.speechSynthesis;

    // FunÃ§Ã£o para converter letras em sons abertos de Portugal
    function getPhoneticSound(text) {
        return text.replace(/A/g, 'Ã').replace(/E/g, 'Ã‰').replace(/O/g, 'Ã“');
    }

    function speak(text) {
        synth.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        const voices = synth.getVoices();
        // Procura vozes PT-PT explicitamente
        const ptPtVoice = voices.find(v => v.lang === 'pt-PT' || v.lang === 'pt_PT' || (v.lang.startsWith('pt') && v.name.includes('Portugal')));
        
        if (ptPtVoice) utterance.voice = ptPtVoice;
        utterance.lang = 'pt-PT';
        utterance.rate = 0.6; // Reduzido para maior clareza silÃ¡bica
        utterance.pitch = 1.0;
        synth.speak(utterance);
    }

    function randomizeConsonant() {
        const idx = Math.floor(Math.random() * consonants.length);
        activeConsonant = consonants[idx];
        document.getElementById('main-consonant').innerText = activeConsonant;
        speak(`Letra ${activeConsonant}`);
    }

    document.getElementById('start-btn').addEventListener('click', () => {
        document.getElementById('start-overlay').style.display = 'none';
        randomizeConsonant();
    });

    document.getElementById('random-btn').addEventListener('click', randomizeConsonant);

    let draggedEl = null;

    document.querySelectorAll('.vowel-card').forEach(card => {
        card.addEventListener('touchstart', (e) => {
            const touch = e.touches[0];
            draggedEl = card.cloneNode(true);
            draggedEl.style.position = 'fixed';
            draggedEl.style.zIndex = '1000';
            draggedEl.style.left = touch.clientX - 35 + 'px';
            draggedEl.style.top = touch.clientY - 35 + 'px';
            document.body.appendChild(draggedEl);
            
            // Requisito: "Letra Ã", "Letra Ã‰", "Letra Ã“" (sons abertos)
            speak("Letra " + getPhoneticSound(card.dataset.vowel));
        });
    });

    window.addEventListener('touchmove', (e) => {
        if (!draggedEl) return;
        const touch = e.touches[0];
        draggedEl.style.left = touch.clientX - 35 + 'px';
        draggedEl.style.top = touch.clientY - 35 + 'px';
    });

    window.addEventListener('touchend', (e) => {
        if (!draggedEl) return;
        const touch = e.changedTouches[0];
        const target = document.getElementById('target').getBoundingClientRect();

        if (touch.clientX > target.left && touch.clientX < target.right &&
            touch.clientY > target.top && touch.clientY < target.bottom) {
            
            const v = draggedEl.dataset.vowel;
            
            // Busca no dicionÃ¡rio ou fabrica o som com fonÃ©tica aberta
            let soundToPlay = "";
            if (dictionary[activeConsonant] && dictionary[activeConsonant][v]) {
                soundToPlay = dictionary[activeConsonant][v];
            } else {
                soundToPlay = activeConsonant + getPhoneticSound(v);
            }
            
            const targetZone = document.getElementById('target');
            const resDiv = document.getElementById('result-display');
            
            targetZone.innerText = v;
            document.getElementById('res-img').innerText = (dictionary[activeConsonant] && dictionary[activeConsonant].img) || 'âœ¨';
            document.getElementById('res-txt').innerText = activeConsonant + v;
            
            resDiv.classList.add('show');
            speak(soundToPlay);

            setTimeout(() => {
                resDiv.classList.remove('show');
                targetZone.innerText = '?';
            }, 2200);
        }
        draggedEl.remove();
        draggedEl = null;
    });

    window.speechSynthesis.onvoiceschanged = () => { window.speechSynthesis.getVoices(); };
</script>

</body>
</html>
